# Fichero: ./platformio.ini
# Último cambio: Añadida la build_flag para deshabilitar la lectura del ID del chip táctil y resolver el crash en el arranque.
# Descripción: Se traslada la solución del 'sdkconfig' a este fichero para una gestión centralizada. El crash 'ESP_ERR_INVALID_STATE' se debe a un NACK en la comunicación I2C al intentar leer el ID del chip táctil CST816S. La solución definitiva es inyectar la directiva de preprocesador '-DCONFIG_ESP_LCD_TOUCH_CST816S_DISABLE_READ_ID=y' a través de 'build_flags'. Este es el método canónico en PlatformIO para sobreescribir configuraciones del SDK, evitando la transacción I2C fallida y permitiendo que la inicialización del hardware se complete con éxito. Se aplica a ambos entornos ya que utilizan el mismo chip.
# Último cambio: 20/08/2025 - 05:31

#
# PlatformIO Project Configuration File
#
# NOTA DE MIGRACIÓN:
# Este fichero está configurado para usar la estructura de directorios de ESP-IDF.
# El código fuente principal está en la carpeta 'main', y los componentes adicionales
# en la carpeta 'components'.

[platformio]
# --- SELECCIÓN DE PLACA ---
# Cambia este valor para elegir el hardware a compilar.
# Opciones: ws1_9ts, ws1_47ts
default_envs = ws1_9ts
src_dir = main

# =================================================================
# === ENTORNO PARA WAVESHARE 1.9" =================================
# =================================================================
[env:ws1_9ts]
# -- Configuración General --
platform = espressif32
board = esp32-c6-devkitc-1
framework = espidf

# -- Opciones de Compilación y Subida --
board_build.flash_mode = dio
board_build.flash_freq = 80m
board_build.partitions = partitions.csv
board_build.sdkconfig_path = sdkconfig.ws1_9ts

# -- Opciones del Monitor Serie --
monitor_speed = 115200

# -- Banderas de Compilación --
build_flags = 
    -DCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6=y
    -UCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6_147
    -DCONFIG_ESP_LCD_TOUCH_CST816S_DISABLE_READ_ID=y # [CORRECCIÓN] Evita el crash del driver del touch.

# =================================================================
# === ENTORNO PARA WAVESHARE 1.47" ================================
# =================================================================
[env:ws1_47ts]
# -- Configuración General --
platform = espressif32
board = esp32-c6-devkitc-1
framework = espidf

# -- Opciones de Compilación y Subida --
board_build.flash_mode = dio
board_build.flash_freq = 80m
board_build.partitions = partitions.csv
board_build.sdkconfig_path = sdkconfig.ws1_47ts

# -- Opciones del Monitor Serie --
monitor_speed = 115200

# -- Banderas de Compilación --
build_flags = 
    -DCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6_147=y
    -UCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6
    -DCONFIG_ESP_LCD_TOUCH_CST816S_DISABLE_READ_ID=y # [CORRECCIÓN] Evita el crash del driver del touch.
