# Fichero: ./platformio.ini
# Descripción: Diagnóstico: Pérdida de comunicación serie y fallo de WiFi en la placa de 1.47" tras despertar de light sleep. Causa Raíz: La configuración de gestión de energía por defecto para el ESP32-C6 apaga los dominios de alimentación 'TOP' (que incluye USB-JTAG) y 'MODEM' (WiFi) durante el light sleep. Se ha demostrado que las banderas de compilación son insuficientes para prevenir este comportamiento en el hardware específico de la 1.47". Solución Definitiva: Se ha eliminado el intento de solución mediante build flags. La solución ahora se implementa programáticamente en 'screen_manager.c', donde se invoca explícitamente a 'esp_sleep_pd_config' para forzar que los dominios 'TOP' y 'MODEM' permanezcan encendidos durante el light sleep, únicamente para la placa de 1.47".
# Último cambio: 22/08/2025 - 07:42

#
# PlatformIO Project Configuration File
#
# NOTA DE MIGRACIÓN:
# Este fichero está configurado para usar la estructura de directorios de ESP-IDF.
# El código fuente principal está en la carpeta 'main', y los componentes adicionales
# en la carpeta 'components'.

[platformio]
# --- SELECCIÓN DE PLACA ---
# Cambia este valor para elegir el hardware a compilar.
# Opciones: ws1_9ts, ws1_47ts
default_envs = ws1_9ts
src_dir = main

# =================================================================
# === ENTORNO PARA WAVESHARE 1.9" =================================
# =================================================================
[env:ws1_9ts]
# -- Configuración General --
platform = espressif32
board = esp32-c6-devkitc-1
framework = espidf

# -- Opciones de Compilación y Subida --
board_build.flash_mode = dio
board_build.flash_freq = 80m
board_build.partitions = partitions.csv
board_build.sdkconfig_path = sdkconfig.ws1_9ts

# -- Opciones del Monitor Serie --
monitor_speed = 115200

# -- Banderas de Compilación --
build_flags = 
    -DCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6=y
    -UCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6_147
    -UCONFIG_FATFS_LFN_NONE
    -DCONFIG_FATFS_LFN_HEAP
    -DCONFIG_FATFS_MAX_LFN=255

# =================================================================
# === ENTORNO PARA WAVESHARE 1.47" ================================
# =================================================================
[env:ws1_47ts]
# -- Configuración General --
platform = espressif32
board = esp32-c6-devkitc-1
framework = espidf

# -- Opciones de Compilación y Subida --
board_build.flash_mode = dio
board_build.flash_freq = 80m
board_build.partitions = partitions.csv
board_build.sdkconfig_path = sdkconfig.ws1_47ts
board_build.flash_size = 2MB

# -- Opciones del Monitor Serie --
monitor_speed = 115200

# -- Banderas de Compilación --
build_flags = 
    -DCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6_147=y
    -UCONFIG_DIYTOGETHER_BOARD_WAVESHARE_C6
    -UCONFIG_FATFS_LFN_NONE
    -DCONFIG_FATFS_LFN_HEAP
    -DCONFIG_FATFS_MAX_LFN=255

